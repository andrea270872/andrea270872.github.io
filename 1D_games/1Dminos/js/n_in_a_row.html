<!DOCTYPE html>
<html lang="en">
<body>
<script>

var score = 0;

var matchAndCompact = function(){
	if (pile.length<=1){
		return;
	}

	// count occurrences
	var counters = [];
	var counter = 1;
	for (var i=1;i<pile.length;i++){
		if (pile[i-1]==pile[i]){
			counter++;
		} else {
			counters.push([counter,pile[i-1]]);
			counter = 1;
		}
	}
	counters.push([counter,pile[i-1]]);
	console.log(counters);
	
	// expand all elements with less than 3 occurrences
	var newPile = [];
	for (var i=0;i<counters.length;i++){
		if (counters[i][0]==1){
			newPile.push( counters[i][1] );
		} else if (counters[i][0]==2){
			newPile.push( counters[i][1] );
			newPile.push( counters[i][1] );
		} else {
			score += 100*(counters[i][0]-2);
		}
	}
	pile = newPile;
}

var pile = [0,0,0,0,1,1,0,1,2,1,1,1];
console.log( pile );
matchAndCompact();
console.log( pile );
console.log( score );

</script>
</body>
</html>
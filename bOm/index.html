<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="blockly/blockly_compressed.js"></script>
<script src="blockly/blocks_compressed.js"></script>
<script src="blockly/javascript_compressed.js"></script>
<script src="blockly/msg/en.js"></script>

<script src="bOm_v0.js"></script>

</head>
<body>

<div id="blocklyDiv" style="height: 480px; width: 600px;"></div>
<textarea id="textarea" rows="4" cols="50"></textarea>
<button id="runTheCode">RUN</button>

<canvas style="display:none;" id="__bOmCanvas"></canvas>



<script src="myBlocks.js"></script>
<script src="toolbox_def.js"></script>
<script>

const isMobile = () => /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);


if (!isMobile()) {
  alert("Open this editor on mobile devices, please.");
  // TO DO location.replace('https://en.wikipedia.org/wiki/Mobile_phone');
}

let workspace = Blockly.inject('blocklyDiv', {toolbox: toolbox});
workspace.addChangeListener(Blockly.Events.disableOrphans);

function myUpdateFunction(event) {
  let code = Blockly.JavaScript.workspaceToCode(workspace);
  document.getElementById('textarea').value = code;
}
workspace.addChangeListener(myUpdateFunction);


document.getElementById('runTheCode').addEventListener('click', (evt)=>{

  let code = Blockly.JavaScript.workspaceToCode(workspace);
  code =
`
(async ()=>{
${code}
clear(0,0,255);
rect(0,0,100,50);
rect(750,1150,40,40);
draw("phone_imgs/die1.png",100,100);
draw("phone_imgs/die1.png",300,200,50,50);
//await wait(10);
console.log("tap now");
await waitTap(); // tap to continue

saveScreen("screenSaved.jpg",50,50,450,450);

allDone();
})();
  `;

  eval( code );
  // DEBUG 
  console.log(code);
},false);

</script>

</body>
</html>